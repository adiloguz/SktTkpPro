
<div class="flex h-screen bg-slate-50 dark:bg-slate-950 overflow-hidden relative transition-colors duration-300 font-sans">
  
  <!-- Mobile Backdrop Overlay -->
  @if (isMobileMenuOpen()) {
    <div 
      class="fixed inset-0 bg-slate-900/60 z-20 md:hidden backdrop-blur-sm transition-opacity animate-fade-in"
      (click)="closeMobileMenu()"
    ></div>
  }

  <!-- Notification Panel Overlay -->
  @if (isNotificationPanelOpen()) {
    <div 
      class="fixed inset-0 bg-transparent z-40"
      (click)="closeNotifications()"
    ></div>
  }

  <!-- Sidebar -->
  <aside 
    class="fixed inset-y-0 left-0 z-30 w-72 bg-slate-900 text-white flex flex-col shadow-2xl transition-transform duration-300 ease-in-out md:translate-x-0 md:static md:shadow-none border-r border-slate-800"
    [class.-translate-x-full]="!isMobileMenuOpen()"
    [class.translate-x-0]="isMobileMenuOpen()"
  >
    <!-- Sidebar Header -->
    <div class="p-8 flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-bold tracking-tight flex items-center gap-2 bg-gradient-to-r from-emerald-400 to-teal-300 bg-clip-text text-transparent">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-8 h-8 text-emerald-400">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 21v-7.5a.75.75 0 01.75-.75h3a.75.75 0 01.75.75V21m-4.5 0H2.36m11.14 0H18m0 0h3.64m-1.39 0V9.349m-16.5 11.65V9.35m0 0a3.001 3.001 0 003.75-.615A2.993 2.993 0 009.75 9.75c.896 0 1.7-.393 2.25-1.016a2.993 2.993 0 002.25 1.016c.896 0 1.7-.393 2.25-1.016a3.001 3.001 0 003.75.614m-16.5 0a3.004 3.004 0 01-.621-4.72L4.318 3.44A1.5 1.5 0 015.378 3h13.243a1.5 1.5 0 011.06.44l1.19 1.189a3 3 0 01-.621 4.72m-13.5 8.65h3.75a.75.75 0 00.75-.75V13.5a.75.75 0 00-.75-.75H6.75a.75.75 0 00-.75.75v3.75c0 .415.336.75.75.75z" />
          </svg>
          MarketSKT
        </h1>
        <p class="text-[10px] text-slate-400 mt-1 font-bold tracking-[0.2em] uppercase pl-1">Stok & SKT Yönetimi</p>
      </div>
      <!-- Close Button (Mobile Only) -->
      <button (click)="closeMobileMenu()" class="md:hidden text-slate-400 hover:text-white p-1 rounded hover:bg-slate-800 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <!-- Navigation -->
    <nav class="flex-1 px-4 space-y-3 overflow-y-auto py-4">
      
      <p class="px-4 text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2">Menü</p>

      <a routerLink="/dashboard" routerLinkActive="bg-emerald-500/10 text-emerald-400 border-l-4 border-emerald-500 shadow-[0_0_20px_rgba(16,185,129,0.1)]" class="flex items-center gap-3 px-4 py-3.5 text-slate-400 rounded-r-xl border-l-4 border-transparent hover:bg-slate-800 hover:text-slate-200 transition-all group">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 group-hover:scale-110 transition-transform">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" />
        </svg>
        <span class="font-medium tracking-wide">Genel Bakış</span>
      </a>

      <a routerLink="/products" routerLinkActive="bg-emerald-500/10 text-emerald-400 border-l-4 border-emerald-500 shadow-[0_0_20px_rgba(16,185,129,0.1)]" class="flex items-center gap-3 px-4 py-3.5 text-slate-400 rounded-r-xl border-l-4 border-transparent hover:bg-slate-800 hover:text-slate-200 transition-all group relative">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 group-hover:scale-110 transition-transform">
          <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" />
        </svg>
        <span class="font-medium tracking-wide">Ürün Listesi</span>
        @if (alertCount > 0) {
          <span class="absolute right-3 top-3.5 flex h-5 w-5 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white shadow-lg shadow-red-500/50 animate-pulse">
            {{ alertCount }}
          </span>
        }
      </a>

      <a routerLink="/analytics" routerLinkActive="bg-emerald-500/10 text-emerald-400 border-l-4 border-emerald-500 shadow-[0_0_20px_rgba(16,185,129,0.1)]" class="flex items-center gap-3 px-4 py-3.5 text-slate-400 rounded-r-xl border-l-4 border-transparent hover:bg-slate-800 hover:text-slate-200 transition-all group">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 group-hover:scale-110 transition-transform">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6a7.5 7.5 0 107.5 7.5h-7.5V6z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 10.5H21A7.5 7.5 0 0013.5 3v7.5z" />
        </svg>
        <span class="font-medium tracking-wide">Analizler</span>
      </a>

      <div class="pt-4 pb-2">
         <p class="px-4 text-xs font-semibold text-slate-500 uppercase tracking-wider">Sistem</p>
      </div>

      <a routerLink="/settings" routerLinkActive="bg-emerald-500/10 text-emerald-400 border-l-4 border-emerald-500 shadow-[0_0_20px_rgba(16,185,129,0.1)]" class="flex items-center gap-3 px-4 py-3.5 text-slate-400 rounded-r-xl border-l-4 border-transparent hover:bg-slate-800 hover:text-slate-200 transition-all group">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 group-hover:scale-110 transition-transform">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.108l.737-.527a1.125 1.125 0 011.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.107 1.204.165.397.505.71.93.78l.893.15c.543.09.94.56.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.893.149c-.425.07-.765.383-.93.78-.165.398-.143.854.107 1.204l.527.738c.32.447.269 1.06-.12 1.45l-.774.773a1.125 1.125 0 01-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.397.165-.71.505-.781.929l-.149.894c-.09.542-.56.94-1.11.94h-1.094c-.55 0-1.019-.398-1.11-.94l-.148-.894c-.071-.424-.384-.764-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.269-1.45-.12l-.773-.774a1.125 1.125 0 01-.12-1.45l.527-.737c.25-.35.273-.806.108-1.204-.165-.397-.505-.71-.93-.78l-.894-.15c-.542-.09-.94-.56-.94-1.109v-1.094c0-.55.398-1.02.94-1.11l.894-.149c.424-.07.765-.383.93-.78.165-.398.143-.854-.107-1.204l-.527-.738a1.125 1.125 0 01.12-1.45l.773-.773a1.125 1.125 0 011.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
        <span class="font-medium tracking-wide">Ayarlar</span>
      </a>
    </nav>

    <div class="p-6 bg-slate-950 text-xs text-slate-600 border-t border-slate-800">
      <p>&copy; 2024 MarketSKT Pro v2.0</p>
    </div>
  </aside>

  <!-- Notification Panel (Slide Over) -->
  <div 
    class="fixed inset-y-0 right-0 z-50 w-full md:w-96 bg-white dark:bg-slate-900 shadow-2xl transform transition-transform duration-300 ease-in-out border-l border-slate-200 dark:border-slate-800"
    [class.translate-x-0]="isNotificationPanelOpen()"
    [class.translate-x-full]="!isNotificationPanelOpen()"
  >
    <div class="flex flex-col h-full">
      <div class="p-5 border-b border-slate-100 dark:border-slate-800 flex items-center justify-between bg-slate-50 dark:bg-slate-900">
        <h2 class="font-bold text-slate-800 dark:text-slate-100 flex items-center gap-2 text-lg">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 text-emerald-500">
            <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
          </svg>
          Bildirim Merkezi
        </h2>
        <button (click)="closeNotifications()" class="p-2 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-full text-slate-500 transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      
      <div class="flex-1 overflow-y-auto p-5 space-y-6 bg-white dark:bg-slate-900">
        <!-- Expired Section -->
        @if (expiredCount().length > 0) {
          <div>
            <h3 class="text-xs font-bold text-red-600 dark:text-red-400 uppercase tracking-wider mb-3 flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span>
              SKT Geçenler ({{ expiredCount().length }})
            </h3>
            <div class="space-y-3">
              @for (item of expiredCount(); track item.id) {
                <div class="p-4 bg-red-50 dark:bg-red-900/10 border border-red-100 dark:border-red-900/50 rounded-xl group hover:shadow-md transition-all">
                  <div class="flex justify-between items-start">
                    <p class="text-sm font-bold text-slate-800 dark:text-red-200">{{ item.name }}</p>
                    <span class="text-[10px] bg-red-100 text-red-700 px-2 py-0.5 rounded-full font-bold dark:bg-red-900 dark:text-red-300">İMHALIK</span>
                  </div>
                  <p class="text-xs text-red-600 dark:text-red-400 mt-1">Son Kullanma: {{ item.expiryDate }}</p>
                  <div class="mt-3 flex justify-end">
                    <a routerLink="/products" (click)="closeNotifications()" class="text-xs font-bold text-red-600 dark:text-red-400 hover:underline cursor-pointer flex items-center gap-1">
                      İncele <span class="group-hover:translate-x-1 transition-transform">&rarr;</span>
                    </a>
                  </div>
                </div>
              }
            </div>
          </div>
        }

        <!-- Warning Section -->
        @if (warningCount().length > 0) {
          <div>
            <h3 class="text-xs font-bold text-amber-600 dark:text-amber-400 uppercase tracking-wider mb-3 flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-amber-500"></span>
              Yaklaşanlar ({{ warningCount().length }})
            </h3>
            <div class="space-y-3">
              @for (item of warningCount(); track item.id) {
                <div class="p-4 bg-amber-50 dark:bg-amber-900/10 border border-amber-100 dark:border-amber-900/50 rounded-xl group hover:shadow-md transition-all">
                  <p class="text-sm font-bold text-slate-800 dark:text-amber-200">{{ item.name }}</p>
                  <div class="flex justify-between items-center mt-2">
                    <p class="text-xs font-semibold text-amber-700 dark:text-amber-500">{{ getDays(item.expiryDate) }} gün kaldı</p>
                    <a routerLink="/products" (click)="closeNotifications()" class="text-xs font-bold text-amber-600 dark:text-amber-400 hover:underline cursor-pointer flex items-center gap-1">
                      Aksiyon Al <span class="group-hover:translate-x-1 transition-transform">&rarr;</span>
                    </a>
                  </div>
                </div>
              }
            </div>
          </div>
        }

        @if (alertCount === 0) {
          <div class="flex flex-col items-center justify-center h-64 text-slate-400">
            <div class="bg-slate-100 dark:bg-slate-800 p-4 rounded-full mb-4">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 text-emerald-500">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <p class="font-medium text-slate-600 dark:text-slate-300">Bildirim yok</p>
            <p class="text-sm mt-1">Her şey kontrol altında!</p>
          </div>
        }
      </div>
    </div>
  </div>

  <!-- Main Content Wrapper -->
  <div class="flex-1 flex flex-col h-full overflow-hidden bg-slate-50 dark:bg-slate-950">
    
    <!-- Mobile Header -->
    <header class="bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 px-4 py-3 flex items-center justify-between z-10 sticky top-0 shadow-sm md:hidden">
      <div class="flex items-center gap-3">
        <button (click)="toggleMobileMenu()" class="text-slate-600 dark:text-slate-300 hover:text-slate-900 dark:hover:text-white hover:bg-slate-100 dark:hover:bg-slate-800 p-2 rounded-lg transition-colors -ml-2">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>
        </button>
        <h1 class="text-lg font-bold text-slate-800 dark:text-slate-200 flex items-center gap-2">
           MarketSKT
        </h1>
      </div>

      <!-- Mobile Right Actions -->
      <div class="flex items-center gap-2">
        <button (click)="toggleNotifications()" class="relative p-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full">
           <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
            </svg>
            @if (alertCount > 0) {
              <span class="absolute top-1 right-1 flex h-2.5 w-2.5">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-red-500"></span>
              </span>
            }
        </button>
      </div>
    </header>

    <!-- Desktop Header (Top Bar) -->
    <div class="hidden md:flex bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 px-8 py-4 justify-between items-center transition-colors duration-300 z-20">
      <div>
         <h2 class="text-xl font-bold text-slate-800 dark:text-slate-100 tracking-tight">
          Hoşgeldiniz
        </h2>
        <p class="text-xs text-slate-500 dark:text-slate-400">Bugün mağazanız nasıl gidiyor?</p>
      </div>
     
      <div class="flex items-center gap-4">
        
        <!-- Theme Toggle -->
        <button (click)="toggleTheme()" class="p-2.5 text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full transition-colors border border-transparent hover:border-slate-200 dark:hover:border-slate-700" title="Karanlık Modu Değiştir">
          @if (themeService.darkMode()) {
             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-amber-400">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
            </svg>
          } @else {
             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-slate-600">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
            </svg>
          }
        </button>

         <button (click)="toggleNotifications()" class="relative p-2.5 text-slate-500 dark:text-slate-400 hover:text-emerald-600 dark:hover:text-emerald-400 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-full transition-all border border-transparent hover:border-slate-200 dark:hover:border-slate-700">
           <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
            </svg>
            @if (alertCount > 0) {
              <span class="absolute top-1.5 right-1.5 flex h-4 w-4 items-center justify-center rounded-full bg-red-500 text-[10px] font-bold text-white ring-2 ring-white dark:ring-slate-900 shadow-sm">
                {{ alertCount }}
              </span>
            }
        </button>
        <div class="h-8 w-px bg-slate-200 dark:bg-slate-800 mx-2"></div>
        <div class="flex items-center gap-3">
          <div class="h-9 w-9 rounded-full bg-gradient-to-tr from-emerald-400 to-teal-600 flex items-center justify-center text-white font-bold text-sm shadow-lg shadow-emerald-500/20">
            M
          </div>
          <div class="text-sm">
            <p class="font-bold text-slate-700 dark:text-slate-200">Yönetici</p>
            <p class="text-xs text-slate-500 dark:text-slate-500">Market Sahibi</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Content -->
    <main class="flex-1 overflow-y-auto p-4 md:p-8 scroll-smooth">
      <div class="max-w-7xl mx-auto pb-20 md:pb-0">
        <router-outlet></router-outlet>
      </div>
    </main>
  </div>
</div>
